replicaCount: 1

image:
  repository: ghcr.io/23skdu/longbow
  pullPolicy: IfNotPresent
  tag: "latest"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "9090"
  prometheus.io/path: "/metrics"

podSecurityContext:
  fsGroup: 2000

securityContext:
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000

# gRPC Configuration
grpc:
  maxRecvMsgSize: "67108864" # 64MB
  maxSendMsgSize: "67108864" # 64MB
  initialWindowSize: "1048576" # 1MB
  initialConnWindowSize: "1048576" # 1MB
  maxConcurrentStreams: 250
  keepAliveTime: "2h"
  keepAliveTimeout: "20s"
  keepAliveMinTime: "5m"
  keepAlivePermitWithoutStream: false

# Rate Limiting Configuration
rateLimit:
  rps: 0 # 0 = disabled
  burst: 0

# HNSW Index Configuration (Performance Tuning)
hnsw:
  m: 32
  efConstruction: 400
  alpha: 1.0
  keepPruned: false
  sq8Enabled: false
  float16Enabled: false

  refinementFactor: 1.0
  useHNSW2: true

# Memory & GC Configuration
memory:
  evictionHeadroom: 0.10
  evictionPolicy: "lru"
  rejectWrites: true
  gcBallastGB: 0
  gogc: 100

# GPU Configuration
gpu:
  enabled: false
  deviceId: 0

# Storage Configuration
storage:
  asyncFsync: true
  doPutBatchSize: 100
  useIOUring: false
  useDirectIO: false

service:
  data:
    enabled: true
    type: ClusterIP
    port: 3000
    annotations: {}
  meta:
    enabled: true
    type: ClusterIP
    port: 3001
    annotations: {}

metrics:
  enabled: true
  port: 9090
  service:
    type: ClusterIP
    annotations: {}
  serviceMonitor:
    enabled: false

# Longbow configuration
config:
  maxMemory: "1073741824" # 1GB default
  maxWALSize: "104857600" # 100MB default
  snapshotInterval: "1h"
  ttl: "0s" # 0s = disabled

# Compaction Configuration
compaction:
  enabled: true
  interval: "30s"
  targetBatchSize: 10000
  minBatches: 10

# Sharding Configuration
sharding:
  auto:
    enabled: false
    threshold: 10000
    splitThreshold: 65536
  ring:
    enabled: true

# Hybrid Search Configuration
hybrid:
  enabled: true
  textColumns: "text" # Comma-separated list of columns to index for keyword search
  alpha: 0.5 # Default weight (0.5 = equal dense/sparse)

# Gossip Mesh Configuration
# SWIM-based failure detection and membership protocol
gossip:
  enabled: true
  # Port for UDP gossip communication (one per pod)
  port: 7946
  # Protocol timing parameters
  protocolPeriod: "200ms" # How often to probe a random member
  interval: "200ms" # Added to satisfy config
  ackTimeout: "100ms" # Timeout for direct ping acknowledgment
  suspicionTimeout: "5s" # Time before suspect member marked dead
  # Discovery configuration
  discovery:
    # Discovery provider: static, dns, or k8s
    provider: "k8s"
    # For static discovery: comma-separated list of seed nodes
    # Example: "longbow-0.longbow:7946,longbow-1.longbow:7946"
    staticPeers: ""
    # For k8s discovery: namespace and label selector
    namespace: "" # Empty = same namespace as pod
    labelSelector: "app.kubernetes.io/name=longbow"
    # For DNS discovery: SRV record to query
    dnsRecord: "_gossip._udp.longbow.default.svc.cluster.local"

# Persistence configuration
persistence:
  wal:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 5Gi
    path: /data
  snapshots:
    enabled: false
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 10Gi
    path: /snapshots

# S3 Backend for Snapshots
# When enabled, snapshots are stored in S3-compatible storage
s3:
  enabled: false
  endpoint: "" # Leave empty for AWS S3, set for MinIO/R2
  bucket: "longbow-snapshots"
  prefix: "" # Optional key prefix (e.g., "prod/vectors")
  region: "us-east-1"
  usePathStyle: false # Set true for MinIO
  # Credentials - use existingSecret or provide directly (not recommended)
  existingSecret: ""
  existingSecretAccessKeyKey: "access-key-id"
  existingSecretSecretKeyKey: "secret-access-key"
  # Direct credentials (not recommended for production)
  accessKeyId: ""
  secretAccessKey: ""

ingress:
  data:
    enabled: false
    className: ""
    annotations: {}
    hosts:
      - host: longbow-data.local
        paths:
          - path: /
            pathType: ImplementationSpecific
    tls: []
  meta:
    enabled: false
    className: ""
    annotations: {}
    hosts:
      - host: longbow-meta.local
        paths:
          - path: /
            pathType: ImplementationSpecific
    tls: []

httpRoute:
  enabled: false
  gateway: {}
  hostnames: []
  rules: []

resources: {}

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

