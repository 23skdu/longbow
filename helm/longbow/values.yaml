replicaCount: 1

image:
  repository: ghcr.io/23skdu/longbow
  pullPolicy: IfNotPresent
  tag: "0.0.8"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "9090"
  prometheus.io/path: "/metrics"

podSecurityContext:
  fsGroup: 2000

securityContext:
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000

# gRPC Configuration
grpc:
  maxRecvMsgSize: 67108864 # 64MB
  maxSendMsgSize: 67108864 # 64MB
  initialWindowSize: 1048576 # 1MB
  initialConnWindowSize: 1048576 # 1MB
  maxConcurrentStreams: 250
  keepAliveTime: "2h"
  keepAliveTimeout: "20s"
  keepAliveMinTime: "5m"
  keepAlivePermitWithoutStream: false

# Gossip Configuration (Cluster)
gossip:
  enabled: false
  port: 7946
  interval: "200ms"
  # advertiseAddr: "127.0.0.1" # Override if needed (e.g. status.podIP)

# Storage Configuration
storage:
  asyncFsync: true
  doPutBatchSize: 100

service:
  data:
    enabled: true
    type: ClusterIP
    port: 3000
    annotations: {}
  meta:
    enabled: true
    type: ClusterIP
    port: 3001
    annotations: {}

metrics:
  enabled: true
  port: 9090
  serviceMonitor:
    enabled: false

# Longbow configuration
config:
  maxMemory: "1073741824" # 1GB default
  maxWALSize: "104857600" # 100MB default
  snapshotInterval: "1h"
  ttl: "0s" # 0s = disabled

# Gossip Mesh Configuration
# SWIM-based failure detection and membership protocol
gossip:
  enabled: true
  # Port for UDP gossip communication (one per pod)
  port: 7946
  # Protocol timing parameters
  protocolPeriod: "200ms"  # How often to probe a random member
  ackTimeout: "100ms"      # Timeout for direct ping acknowledgment
  suspicionTimeout: "5s"   # Time before suspect member marked dead
  # Discovery configuration
  discovery:
    # Discovery provider: static, dns, or k8s
    provider: "k8s"
    # For static discovery: comma-separated list of seed nodes
    # Example: "longbow-0.longbow:7946,longbow-1.longbow:7946"
    staticPeers: ""
    # For k8s discovery: namespace and label selector
    namespace: ""  # Empty = same namespace as pod
    labelSelector: "app.kubernetes.io/name=longbow"
    # For DNS discovery: SRV record to query
    dnsRecord: "_gossip._udp.longbow.default.svc.cluster.local"


# Persistence configuration
persistence:
  wal:
    enabled: false
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 5Gi
    path: /data
  snapshots:
    enabled: false
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 10Gi
    path: /snapshots

# S3 Backend for Snapshots
# When enabled, snapshots are stored in S3-compatible storage
s3:
  enabled: false
  endpoint: "" # Leave empty for AWS S3, set for MinIO/R2
  bucket: "longbow-snapshots"
  prefix: "" # Optional key prefix (e.g., "prod/vectors")
  region: "us-east-1"
  usePathStyle: false # Set true for MinIO
  # Credentials - use existingSecret or provide directly (not recommended)
  existingSecret: ""
  existingSecretAccessKeyKey: "access-key-id"
  existingSecretSecretKeyKey: "secret-access-key"
  # Direct credentials (not recommended for production)
  accessKeyId: ""
  secretAccessKey: ""

ingress:
  data:
    enabled: false
    className: ""
    annotations: {}
    hosts:
      - host: longbow-data.local
        paths:
          - path: /
            pathType: ImplementationSpecific
    tls: []
  meta:
    enabled: false
    className: ""
    annotations: {}
    hosts:
      - host: longbow-meta.local
        paths:
          - path: /
            pathType: ImplementationSpecific
    tls: []

httpRoute:
  enabled: false
  gateway: {}
  hostnames: []
  rules: []

resources: {}

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity: {}
